<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="index.css">

    <title>Fourier drawing</title>
    <meta name="description" content="Discrete Fourier Transform">
    <meta name="author" content="S.Fitzgerald">
</head>

<body>
    <!-- Main -->
    <main id="main">
        <canvas id="canvas" width="1000" height="550"></canvas>
    </main>
    <!-- end of Main -->

    <script src="./codingtrain.js"></script>

    <script>

        function dft(x) {

            const N = x.length;
            const pi = Math.PI;
            let X = [];

            for (let k = 0; k < N; k++) {
                let re = 0;
                let im = 0;
                for (let n = 0; n < N; n++) {
                    let phi = 2 * pi * k * n / N;
                    re += x[n] * Math.cos(phi);
                    im -= x[n] * Math.sin(phi);
                }
                re = re / N;
                im = im / N;
                amp = Math.sqrt(re * re + im * im);
                freq = k;
                phase = Math.atan2(im, re);
                X[k] = { re, im, amp, freq, phase };
            }
            return X;
        }

        function epiCycles(x, y, fourier, rotation = 0) {
            for (let i = 0; i < fourier.length; i++) {
                let cx = x;
                let cy = y;

                let freq = fourier[i].freq;
                let r = fourier[i].amp;
                let phase = fourier[i].phase;

                x += r * Math.cos(freq * t + phase + rotation);
                y += r * Math.sin(freq * t + phase + rotation);

                /* draw circle */
                ctx.beginPath();
                //ctx.strokeStyle = "white";
                ctx.arc(cx, cy, r, 0, TWO_PI);
                ctx.stroke();

                /* draw line from center to edge */
                ctx.beginPath();
                ctx.strokeStyle = "black";
                ctx.moveTo(cx, cy);
                ctx.lineTo(x, y);
                // draw a dot at end of line
                ctx.arc(x, y, dotRad, 0, TWO_PI);
                ctx.stroke();
            }
            return ({ x, y });
        }

        function draw() {

            ctx.fillStyle = 'rgb(220, 242, 255)';
            ctx.fillRect(0, 0, w, h);
            ctx.strokeStyle = 'black';

            pt1 = epiCycles(Cxo, 75, fourierX);

            pt2 = epiCycles(150, Cyo, fourierY, PI / 2);

            pathPt = { x: pt1.x, y: pt2.y };

            path.unshift(pathPt);
            ctx.beginPath();
            for (i = 1; i < path.length; i++) {
                ctx.moveTo(path[i - 1].x, path[i - 1].y);
                ctx.lineTo(path[i].x, path[i].y);
            }
            ctx.stroke();

            // draw line from last circle to wave
            ctx.beginPath();
            ctx.moveTo(pt1.x, pt1.y);
            ctx.lineTo(pathPt.x, pathPt.y - 4);
            ctx.moveTo(pt2.x, pt2.y);
            ctx.lineTo(pathPt.x - 4, pathPt.y);
            ctx.stroke();

            t += dt;

            requestAnimationFrame(draw);
        }

        const PI = Math.PI;
        const TWO_PI = 2.0 * PI;
        const canvas = document.getElementById("canvas");
        const w = canvas.width;
        const h = canvas.height;
        const ctx = canvas.getContext('2d');

        const waveX = [],waveY = []; // the path to replicate
        const skip = 8;
        for (let i = 0; i < drawing.length; i += skip) {
            waveX.push(drawing[i].x);
            waveY.push(drawing[i].y);
        }
        const fourierX = dft(waveX);
        fourierX.sort((a, b) => b.amp - a.amp);
        const fourierY = dft(waveY);
        fourierY.sort((a, b) => b.amp - a.amp);

        const path = []; // the path generated from the Fourier series

        let t = 0;
        const dt = TWO_PI / fourierX.length;

        // coords and dimensions for canvas drawing
        const dotRad = 2;
        const Cxo = w / 2;
        const Cyo = 125 + (h - 125) / 2;

        draw();

    </script>

</body>

</html>