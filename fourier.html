<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="index.css">

    <title>Fourier drawing</title>
    <meta name="description" content="Discrete Fourier Transform">
    <meta name="author" content="S.Fitzgerald">
</head>

<body>
    <!-- Main -->
    <main id="main">
        <canvas id="canvas" width="1000" height="550"></canvas>
    </main>
    <!-- end of Main -->

    <script>

        function dft(x) {

            const N = x.length;
            const pi = Math.PI;
            let X = [];

            for (let k = 0; k < N; k++) {
                let re = 0;
                let im = 0;
                for (let n = 0; n < N; n++) {
                    let phi = 2 * pi * k * n / N;
                    re += x[n] * Math.cos(phi);
                    im -= x[n] * Math.sin(phi);
                }
                re = re / N;
                im = im / N;
                amp = Math.sqrt(re * re + im * im);
                freq = k;
                phase = Math.atan2(im, re);
                X[k] = { re, im, amp, freq, phase };
            }
            return X;
        }

        function line(ctx, x1, y1, x2, y2, color) {
            ctx.save();
            if (color) {
                ctx.strokeStyle = color;
            }
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            ctx.restore();
        }

        let t = 0;
        let wave = [];

        let count = 0;
        let run = true;

        function draw() {

            const PI = Math.PI;
            const TWO_PI = 2.0 * PI;
            let canvas = document.getElementById("canvas");
            let w = canvas.width;
            let h = canvas.height;
            let ctx = canvas.getContext('2d');

            ctx.fillStyle = 'rgb(220, 242, 255)';
            ctx.fillRect(0, 0, w, h);
            ctx.strokeStyle = 'black';

            const dotRad = 2;
            const dt = TWO_PI / 144;
            const Cxo = w / 4;
            const Cyo = h / 2;
            const Ro = Cxo * 1 / 3;
            const WaveX = Cxo + 3 * Ro;

            let cx = Cxo;
            let cy = Cyo;
            let x = cx;
            let y = cy;
            const N = 9;

            ctx.strokeStyle = "gray";
            line(ctx, cx, cy, w, cy);
            line(ctx, WaveX, cy - Ro * 1.5, WaveX, cy + Ro * 1.5);
            line(ctx,
                WaveX + TWO_PI / dt, cy - Ro * 1.5,
                WaveX + TWO_PI / dt, cy + Ro * 1.5
            );
            line(ctx,
                WaveX + 2 * TWO_PI / dt, cy - Ro * 1.5,
                WaveX + 2 * TWO_PI / dt, cy + Ro * 1.5
            );
            line(ctx,
                WaveX + 3 * TWO_PI / dt, cy - Ro * 1.5,
                WaveX + 3 * TWO_PI / dt, cy + Ro * 1.5
            );
            line(ctx, cx + 25, cy - (Ro * (4 / PI)), w, cy - (Ro * (4 / PI)));
            line(ctx, cx + 25, cy + (Ro * (4 / PI)), w, cy + (Ro * (4 / PI)));

            for (let i = 0; i < N; i++) {
                let n = 2 * i + 1;
                cx = x;
                cy = y;

                r = Ro * (4 / (n * PI));
                x += r * Math.cos(n * t);
                y += r * Math.sin(n * t);

                /* draw circle */
                ctx.beginPath();
                ctx.strokeStyle = "white";
                ctx.arc(cx, cy, r, 0, TWO_PI);
                ctx.stroke();

                /* draw line from center to edge */
                ctx.beginPath();
                ctx.strokeStyle = "black";
                ctx.moveTo(cx, cy);
                ctx.lineTo(x, y);
                ctx.arc(x, y, dotRad, 0, TWO_PI);
                ctx.stroke();

            }

            wave.unshift(y);
            if (wave.length >= 1000) wave.pop();

            ctx.beginPath();
            // draw line from last circle to wave
            ctx.moveTo(WaveX - 4, y);
            ctx.lineTo(x, wave[0]);

            // draw an arrow head
            ctx.moveTo(WaveX - 1, y);
            ctx.lineTo(WaveX - 10, wave[0] + 3);
            ctx.moveTo(WaveX - 2, y);
            ctx.lineTo(WaveX - 10, wave[0] - 3);

            ctx.moveTo(WaveX, wave[0]);
            for (let i = 0; i < wave.length; i++) {
                ctx.lineTo(i + WaveX, wave[i]);
            }
            ctx.stroke();
            t += dt;

            if (run) {
                requestAnimationFrame(draw);
            }
            if (wave.length >= w - WaveX) {
                run = true;
            }
        }

        let y = [
            100, 100, 100, -100, -100, -100, 100, 100, 100, -100, -100, -100
        ];

        let ft = dft(y);

        draw();

    </script>

</body>

</html>